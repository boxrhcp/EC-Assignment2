# Key Value Store Template

This is the Java template for the second assignment of Enterprise Computing. For more information regarding the task, please refer to the [kick-off slides](https://isis.tu-berlin.de/pluginfile.php/1502196/mod_resource/content/1/Assignment_2_Kickoff.pdf) or the assignment task sheet.

&nbsp;

## Prerequisites

* Maven

&nbsp;

## How to Build and Run 

Download .zip or clone project.
Don't be alarmed if your IDE identifies multiple compiling errors, as the necessary gRPC classes haven't been generated yet. 

To compile ProtoBuf with Maven, you need the protobuf-maven-plugin, which is already included in the `pom.xml` file. Compile the project with `mvn clean package`. 

This will produce two different .jars in the `target/ folder`. Only the `SNAPSHOT-jar-with-dependencies.jar` file is relevant.

### Server

To start a node, run the .jar with dependencies. Do not forget to provide the necessary arguments `-q` for the path of the configuration file and `-n` for the identity of the current node. 

Usage:
 * `-q <arg>`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;URI to download configuration file
 * `-n <arg>`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the name of this node

So, to start a node, issue this exemplary command:
```bash
java -jar target/ec2019-assignment2-1.0-SNAPSHOT-jar-with-dependencies.jar \
-q src/main/resources/config.xml -n nodeA
```

You can provide both urls or file system paths for the configuration file. Example with a URL:
```bash
java -jar target/ec2019-assignment2-1.0-SNAPSHOT-jar-with-dependencies.jar \
-q https://filebin.net/odxekklu6hwmnf7m/config.xml?t=iitluz3y -n nodeA
```

### Client

We have included a very rudimentary `Client.java` class to help you validate your key-value-store implementation. In order to test requests against a running node cluster, simply run the `main()` method in your preferred Java development environment.

&nbsp;

## Template Overview

Every class of the template is documented with a short description of its purpose and of the most important methods.

 `KVNodeMain` includes the main method, which starts the key-value-store node. The class parses the arguments from command line and creates a single `Configuration` class. The `Configuration` class is responsible for parsing and validating the configuration file. `KVNodeMain` then starts the `Receiver`, i.e. the gRPC server to listen to requests. The `Receiver`, in turn, attaches the custom quorum key-value-store service implementation to the server (`QuorumImpl`). 

Your task consists of extending the current key-value store skeleton and implementing quorum replication in the cluster (local storage and retrieval of data is already provided by the `Memory` class). To do this, you should extend the abstract class `KeyValueStoreImplBase`. 

The abstract class generated by the gRPC compiler implements all of the methods specified in the `resources/kvstore.proto` file, but only throws runtime exceptions saying that the method is unimplemented. We provided a `QuorumImpl` class that extends this abstract class, where you will have to implement the quorum replication service described in the assignment.

The figure below provides a general overview of the classes in the template. The figure also highlights which classes to extend for the assignment. Beyond these two classes, you can also create new classes or modify the provided ones as you see fit. 

![](/src/main/resources/TemplateOverview.png)

&nbsp;

## Troubleshooting
IDEs will flag multiple compiling errors if the necessary gRPC classes haven't been generated yet. If you cannot find `.java` files under `target/generated-sources/protobuf/java` and `grpc-java`, you need to generate these classes with the ProtoBuf compiler. Compiling the project with `mvn clean package` should solve your problem.

Some development environments may take issue with the Configuration and Memory classes, because they are used in static declarations. In my case, for VSCode, I was able to solve the problem by executing `Java:Clean` from the Command Palette. 

If you encounter any issues, take advantage of the isis student forum to discuss with your classmates, or come to the exercise Q&A session.  
